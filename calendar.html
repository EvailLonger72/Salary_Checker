<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Calendar View - Shift Pay Calculator</title>

    <!-- Styles -->
    <style>
      /* Base styles from style.css would be included here */
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui,
          sans-serif;
        margin: 0;
        padding: 0;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }

      .app-container {
        display: flex;
        min-height: 100vh;
      }

      .sidebar {
        width: 250px;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        padding: 20px;
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        position: fixed;
        height: 100vh;
        overflow-y: auto;
        z-index: 100;
        transition: transform 0.3s ease;
      }

      .sidebar-header {
        text-align: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 2px solid #e0e0e0;
      }

      .sidebar-header h2 {
        margin: 0;
        color: #333;
        font-size: 1.5rem;
      }

      .sidebar-header p {
        margin: 5px 0 0 0;
        color: #666;
        font-size: 0.9rem;
      }

      .nav-menu {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .nav-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px 20px;
        margin-bottom: 5px;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        color: #666;
        font-weight: 500;
      }

      .nav-item:hover {
        background: #f0f2f5;
        color: #333;
        transform: translateX(5px);
      }

      .nav-item.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
      }

      .nav-icon {
        font-size: 1.2rem;
      }

      .main-content {
        flex: 1;
        margin-left: 250px;
        padding: 30px;
        overflow-y: auto;
      }

      .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        background: rgba(255, 255, 255, 0.95);
        padding: 25px 30px;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .page-header h1 {
        margin: 0;
        color: #333;
        font-size: 2rem;
      }

      .page-header p {
        margin: 5px 0 0 0;
        color: #666;
        font-size: 1rem;
      }

      .export-btn {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
        border: none;
        border-radius: 10px;
        padding: 12px 20px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .export-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .mobile-menu-toggle {
        display: none;
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 1001;
        background: rgba(255, 255, 255, 0.9);
        border: none;
        border-radius: 10px;
        padding: 10px;
        font-size: 1.5rem;
        cursor: pointer;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .mobile-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 99;
      }

      @media (max-width: 768px) {
        .sidebar {
          transform: translateX(-100%);
        }

        .sidebar.mobile-open {
          transform: translateX(0);
        }

        .main-content {
          margin-left: 0;
          padding: 20px;
        }

        .mobile-menu-toggle {
          display: block;
        }

        .mobile-overlay.active {
          display: block;
        }

        .page-header {
          padding: 20px;
          margin-top: 60px;
        }

        .page-header h1 {
          font-size: 1.5rem;
        }
      }
    </style>

    <!-- Enhanced Calendar Styles -->
    <style>
      /* Calendar Controls */
      .calendar-controls {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 20px;
        margin-bottom: 30px;
        background: rgba(255, 255, 255, 0.95);
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .nav-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 10px;
        padding: 10px 20px;
        font-size: 1.2rem;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .nav-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .current-period h2 {
        margin: 0;
        color: #333;
        font-size: 1.5rem;
        min-width: 200px;
        text-align: center;
      }

      .today-btn {
        background: #4facfe;
        color: white;
        border: none;
        border-radius: 10px;
        padding: 10px 25px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .today-btn:hover {
        background: #00f2fe;
        transform: translateY(-2px);
      }

      .header-actions {
        display: flex;
        gap: 15px;
      }

      .view-toggle-btn {
        background: #e0e0e0;
        color: #666;
        border: none;
        border-radius: 8px;
        padding: 10px 20px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .view-toggle-btn.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .view-toggle-btn:hover:not(.active) {
        background: #d0d0d0;
      }

      /* Calendar Container */
      .calendar-container {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
      }

      /* Calendar Grid */
      .calendar-grid.month-view {
        display: flex;
        flex-direction: column;
      }

      .calendar-header {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 5px;
        margin-bottom: 10px;
      }

      .week-day {
        text-align: center;
        font-weight: 600;
        color: #666;
        padding: 10px;
      }

      .calendar-body {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 5px;
      }

      .calendar-day {
        background: white;
        border: 1px solid #e0e0e0;
        border-radius: 10px;
        padding: 10px;
        min-height: 100px;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
      }

      .calendar-day:hover:not(.empty) {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .calendar-day.empty {
        background: #f5f5f5;
        cursor: default;
      }

      .calendar-day.today {
        background: #e3f2fd;
        border: 2px solid #2196f3;
      }

      .calendar-day.weekend {
        background: #fef5e7;
      }

      .calendar-day.holiday {
        background: #ffebee;
      }

      .calendar-day.has-shift {
        border: 2px solid #667eea;
      }

      .day-number {
        font-weight: 600;
        font-size: 1.1rem;
        margin-bottom: 5px;
      }

      .holiday-name {
        font-size: 0.7rem;
        color: #d32f2f;
        margin-bottom: 5px;
      }

      .day-shifts {
        display: flex;
        gap: 3px;
        flex-wrap: wrap;
        margin-bottom: 5px;
      }

      .shift-indicator {
        padding: 2px 8px;
        border-radius: 5px;
        font-size: 0.75rem;
        font-weight: 600;
        color: white;
      }

      .shift-indicator.day-shift {
        background: #4facfe;
      }

      .shift-indicator.night-shift {
        background: #764ba2;
      }

      .shift-indicator.planned {
        opacity: 0.7;
        border: 2px dashed white;
      }

      .day-earnings {
        font-size: 0.85rem;
        font-weight: 600;
        color: #28a745;
        position: absolute;
        bottom: 5px;
        right: 10px;
      }

      /* Legend */
      .calendar-legend {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 30px;
        display: flex;
        gap: 30px;
        justify-content: center;
        flex-wrap: wrap;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .legend-color {
        width: 20px;
        height: 20px;
        border-radius: 5px;
      }

      .legend-color.day-shift {
        background: #4facfe;
      }

      .legend-color.night-shift {
        background: #764ba2;
      }

      .legend-color.overtime {
        background: #ff9800;
      }

      .legend-color.holiday {
        background: #f44336;
      }

      /* Monthly Summary */
      .monthly-summary {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
      }

      .monthly-summary h3 {
        margin-bottom: 20px;
        color: #333;
        font-size: 1.3rem;
      }

      .summary-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
      }

      .summary-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 25px;
        border-radius: 15px;
        display: flex;
        align-items: center;
        gap: 20px;
      }

      .summary-icon {
        font-size: 2.5rem;
      }

      .summary-content h4 {
        font-size: 1.8rem;
        margin-bottom: 5px;
      }

      .summary-content p {
        opacity: 0.9;
      }

      /* Enhanced Shift Planning */
      .shift-planning {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
      }

      .shift-planning h3 {
        margin-bottom: 25px;
        color: #333;
        font-size: 1.3rem;
      }

      /* Shift Suggestions */
      .shift-suggestions {
        margin-bottom: 30px;
      }

      .suggestions-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 15px;
      }

      .suggestions-header h4 {
        margin: 0;
        color: #555;
        font-size: 1.1rem;
      }

      .suggestions-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin-bottom: 25px;
      }

      .shift-suggestion {
        background: linear-gradient(135deg, #f8f9ff 0%, #e8f2ff 100%);
        border: 2px solid #e0e8ff;
        border-radius: 12px;
        padding: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .shift-suggestion:hover {
        border-color: #667eea;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
      }

      .suggestion-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }

      .suggestion-shift {
        font-weight: 700;
        color: #667eea;
        font-size: 1.1rem;
      }

      .suggestion-times {
        font-weight: 600;
        color: #333;
        font-size: 0.95rem;
      }

      .suggestion-count {
        font-size: 0.85rem;
        color: #666;
        font-style: italic;
      }

      /* Enhanced Quick Add Form */
      .quick-add-form {
        background: #f8f9fa;
        padding: 25px;
        border-radius: 15px;
        border: 2px dashed #dee2e6;
      }

      .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
      }

      .form-group {
        display: flex;
        flex-direction: column;
      }

      .form-group label {
        font-weight: 600;
        color: #555;
        margin-bottom: 8px;
        font-size: 0.95rem;
      }

      .plan-input {
        padding: 12px 15px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-size: 1rem;
        transition: all 0.3s ease;
        background: white;
      }

      .plan-input:focus {
        outline: none;
        border-color: #4facfe;
        box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
      }

      .add-plan-btn {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
        border: none;
        border-radius: 12px;
        padding: 15px 30px;
        font-weight: 600;
        font-size: 1.1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 100%;
        margin-top: 10px;
      }

      .add-plan-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);
      }

      /* Modal Styles */
      .modal {
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        animation: fadeIn 0.3s;
      }

      .modal-content {
        background-color: white;
        margin: 5% auto;
        padding: 30px;
        border-radius: 20px;
        width: 90%;
        max-width: 600px;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        position: relative;
        animation: slideIn 0.3s;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes slideIn {
        from {
          transform: translateY(-50px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .close {
        position: absolute;
        right: 20px;
        top: 20px;
        font-size: 28px;
        font-weight: bold;
        color: #aaa;
        cursor: pointer;
        transition: color 0.3s ease;
      }

      .close:hover {
        color: #000;
      }

      .shift-details-list {
        margin: 20px 0;
      }

      .shift-detail-item {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 15px;
        border-left: 5px solid #4facfe;
        transition: all 0.3s ease;
      }

      .shift-detail-item.planned {
        opacity: 0.8;
        border-style: dashed;
      }

      .shift-detail-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .shift-detail-header h5 {
        margin: 0;
        color: #333;
        font-size: 1.1rem;
      }

      .shift-actions {
        display: flex;
        gap: 10px;
      }

      .edit-shift-btn,
      .delete-shift-btn {
        padding: 8px 15px;
        border: none;
        border-radius: 8px;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .edit-shift-btn {
        background: #007bff;
        color: white;
      }

      .edit-shift-btn:hover {
        background: #0056b3;
        transform: translateY(-1px);
      }

      .delete-shift-btn {
        background: #dc3545;
        color: white;
      }

      .delete-shift-btn:hover {
        background: #c82333;
        transform: translateY(-1px);
      }

      .shift-detail-content p {
        margin: 8px 0;
        color: #666;
      }

      .edit-shift-form {
        background: #fff;
        padding: 20px;
        border-radius: 10px;
        border: 2px solid #e3f2fd;
      }

      .form-row {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 15px;
      }

      .form-row label {
        min-width: 100px;
        font-weight: 600;
        color: #555;
      }

      .form-row input,
      .form-row select {
        flex: 1;
        padding: 10px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 1rem;
      }

      .form-row input:focus,
      .form-row select:focus {
        outline: none;
        border-color: #4facfe;
      }

      .form-actions {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
        margin-top: 20px;
      }

      .save-btn,
      .cancel-btn {
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .save-btn {
        background: #28a745;
        color: white;
      }

      .save-btn:hover {
        background: #218838;
        transform: translateY(-1px);
      }

      .cancel-btn {
        background: #6c757d;
        color: white;
      }

      .cancel-btn:hover {
        background: #5a6268;
        transform: translateY(-1px);
      }

      .night-premium-badge {
        background: #764ba2;
        color: white;
        padding: 3px 10px;
        border-radius: 15px;
        font-size: 0.85rem;
        font-weight: 600;
      }

      .overtime-badge {
        background: #ff9800;
        color: white;
        padding: 2px 8px;
        border-radius: 5px;
        font-size: 0.75rem;
        margin-top: 5px;
      }

      .day-total {
        margin-top: 25px;
        padding-top: 20px;
        border-top: 2px solid #e0e0e0;
        font-size: 1.1rem;
        font-weight: 600;
        color: #333;
      }

      .quick-add-modal-btn {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
        border: none;
        border-radius: 12px;
        padding: 15px 25px;
        font-weight: 600;
        cursor: pointer;
        width: 100%;
        margin-top: 20px;
        font-size: 1.1rem;
        transition: all 0.3s ease;
      }

      .quick-add-modal-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);
      }

      /* Mobile Responsive */
      @media (max-width: 768px) {
        .calendar-controls {
          flex-wrap: wrap;
          gap: 10px;
          padding: 15px;
        }

        .current-period h2 {
          font-size: 1.2rem;
          min-width: auto;
        }

        .nav-btn {
          padding: 8px 15px;
          font-size: 1rem;
        }

        .calendar-container,
        .shift-planning,
        .monthly-summary {
          padding: 15px;
          margin-bottom: 20px;
        }

        .calendar-day {
          min-height: 80px;
          padding: 5px;
        }

        .day-number {
          font-size: 0.9rem;
        }

        .shift-indicator {
          font-size: 0.65rem;
          padding: 1px 5px;
        }

        .day-earnings {
          font-size: 0.75rem;
          position: static;
          margin-top: 5px;
        }

        .summary-grid {
          grid-template-columns: repeat(2, 1fr);
          gap: 15px;
        }

        .summary-card {
          padding: 15px;
          flex-direction: column;
          text-align: center;
        }

        .summary-icon {
          font-size: 2rem;
        }

        .summary-content h4 {
          font-size: 1.5rem;
        }

        .suggestions-grid {
          grid-template-columns: 1fr;
        }

        .shift-suggestion {
          padding: 12px;
        }

        .form-grid {
          grid-template-columns: 1fr;
          gap: 15px;
        }

        .quick-add-form {
          padding: 20px;
        }

        .modal-content {
          margin: 10% auto;
          padding: 20px;
          width: 95%;
          max-height: 85vh;
        }

        .shift-actions {
          flex-direction: column;
          gap: 8px;
        }

        .edit-shift-btn,
        .delete-shift-btn {
          width: 100%;
        }

        .form-row {
          flex-direction: column;
          align-items: stretch;
          gap: 8px;
        }

        .form-row label {
          min-width: auto;
        }

        .form-actions {
          flex-direction: column;
        }

        .save-btn,
        .cancel-btn {
          width: 100%;
        }
      }
    </style>

    <!-- Favicon -->
    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>📅</text></svg>"
    />

    <!-- Preload Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  </head>
  <body>
    <div class="app-container">
      <!-- Sidebar Navigation -->
      <nav class="sidebar">
        <div class="sidebar-header">
          <h2>🏭 ShiftPay</h2>
          <p>Calendar View</p>
        </div>
        <ul class="nav-menu">
          <li
            class="nav-item"
            onclick="window.location.href='index.html#dashboard'"
          >
            <span class="nav-icon">📊</span>
            Dashboard
          </li>
          <li
            class="nav-item"
            onclick="window.location.href='index.html#calculator'"
          >
            <span class="nav-icon">💰</span>
            Calculator
          </li>
          <li
            class="nav-item"
            onclick="window.location.href='index.html#weekly'"
          >
            <span class="nav-icon">📅</span>
            Weekly Report
          </li>
          <li class="nav-item active">
            <span class="nav-icon">🗓️</span>
            Calendar View
          </li>
          <li
            class="nav-item"
            onclick="window.location.href='tax-calculator.html'"
          >
            <span class="nav-icon">🧮</span>
            Tax Calculator
          </li>
          <li
            class="nav-item"
            onclick="window.location.href='index.html#shifts'"
          >
            <span class="nav-icon">⏰</span>
            Shift Schedule
          </li>
          <li
            class="nav-item"
            onclick="window.location.href='index.html#settings'"
          >
            <span class="nav-icon">⚙️</span>
            Settings
          </li>
        </ul>
      </nav>

      <!-- Main Content -->
      <main class="main-content">
        <div class="page-header">
          <div>
            <h1>Calendar View</h1>
            <p>Visualize your shifts and plan ahead</p>
          </div>
          <div class="header-actions">
            <button class="view-toggle-btn active" data-view="month">
              Month
            </button>
            <button class="view-toggle-btn" data-view="week">Week</button>
            <button class="export-btn" onclick="exportCalendar()">
              📤 Export
            </button>
          </div>
        </div>

        <!-- Calendar Controls -->
        <div class="calendar-controls">
          <button class="nav-btn" onclick="navigateCalendar('prev')">
            <span>◀</span>
          </button>
          <div class="current-period">
            <h2 id="currentPeriod">January 2025</h2>
          </div>
          <button class="nav-btn" onclick="navigateCalendar('next')">
            <span>▶</span>
          </button>
          <button class="today-btn" onclick="goToToday()">Today</button>
        </div>

        <!-- Calendar Grid -->
        <div class="calendar-container">
          <div id="calendarGrid" class="calendar-grid month-view">
            <!-- Calendar will be generated here -->
          </div>
        </div>

        <!-- Legend -->
        <div class="calendar-legend">
          <div class="legend-item">
            <span class="legend-color day-shift"></span>
            <span>Day Shift (C341)</span>
          </div>
          <div class="legend-item">
            <span class="legend-color night-shift"></span>
            <span>Night Shift (C342)</span>
          </div>
          <div class="legend-item">
            <span class="legend-color overtime"></span>
            <span>Overtime</span>
          </div>
          <div class="legend-item">
            <span class="legend-color holiday"></span>
            <span>Holiday/Weekend</span>
          </div>
        </div>

        <!-- Monthly Summary -->
        <div class="monthly-summary">
          <h3>Monthly Summary</h3>
          <div class="summary-grid">
            <div class="summary-card">
              <div class="summary-icon">📅</div>
              <div class="summary-content">
                <h4 id="totalDays">0</h4>
                <p>Days Worked</p>
              </div>
            </div>
            <div class="summary-card">
              <div class="summary-icon">⏱️</div>
              <div class="summary-content">
                <h4 id="totalHours">0h</h4>
                <p>Total Hours</p>
              </div>
            </div>
            <div class="summary-card">
              <div class="summary-icon">💰</div>
              <div class="summary-content">
                <h4 id="totalEarnings">¥0</h4>
                <p>Total Earnings</p>
              </div>
            </div>
            <div class="summary-card">
              <div class="summary-icon">📊</div>
              <div class="summary-content">
                <h4 id="avgDaily">¥0</h4>
                <p>Daily Average</p>
              </div>
            </div>
          </div>
        </div>

    <!-- Shift Details Modal -->
    <div id="shiftModal" class="modal" style="display: none">
      <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h3>Shift Details</h3>
        <div id="modalContent">
          <!-- Shift details will be displayed here -->
        </div>
      </div>
    </div>

    <!-- Mobile menu toggle -->
    <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">☰</button>
    <div class="mobile-overlay" onclick="closeMobileMenu()"></div>

    <!-- Scripts -->
    <script>
      // Minimal break schedule data for calendar functionality
      const SHIFTS = {
        C341: {
          name: "Day Shift",
          defaultStart: "06:30",
          defaultEnd: "17:30",
          breaks: [
            { start: "08:30", end: "08:40", minutes: 10 },
            { start: "10:40", end: "11:25", minutes: 45 },
            { start: "13:05", end: "13:15", minutes: 10 },
            { start: "14:35", end: "14:45", minutes: 10 },
            { start: "16:10", end: "16:20", minutes: 10 },
            { start: "17:20", end: "17:35", minutes: 15 },
          ],
        },
        C342: {
          name: "Night Shift",
          defaultStart: "16:45",
          defaultEnd: "01:25",
          breaks: [
            { start: "18:45", end: "18:55", minutes: 10 },
            { start: "20:55", end: "21:40", minutes: 45 },
            { start: "23:10", end: "23:20", minutes: 10 },
            { start: "00:50", end: "01:00", minutes: 10 },
            { start: "02:25", end: "02:35", minutes: 10 },
            { start: "03:35", end: "03:50", minutes: 15 },
          ],
        },
      };

      // Global variables
      let currentDate = new Date();
      let currentView = "month";
      let weeklyData = JSON.parse(localStorage.getItem("weeklyData") || "[]");
      let plannedShifts = JSON.parse(
        localStorage.getItem("plannedShifts") || "[]"
      );
      let editingEntry = null;

      // Japanese holidays for 2025
      const holidays = {
        "2025-01-01": "元日 (New Year)",
        "2025-01-13": "成人の日 (Coming of Age Day)",
        "2025-02-11": "建国記念の日 (National Foundation Day)",
        "2025-02-23": "天皇誕生日 (Emperor's Birthday)",
        "2025-02-24": "振替休日 (Substitute Holiday)",
        "2025-03-20": "春分の日 (Vernal Equinox Day)",
        "2025-04-29": "昭和の日 (Showa Day)",
        "2025-05-03": "憲法記念日 (Constitution Day)",
        "2025-05-04": "みどりの日 (Greenery Day)",
        "2025-05-05": "こどもの日 (Children's Day)",
        "2025-05-06": "振替休日 (Substitute Holiday)",
        "2025-07-21": "海の日 (Marine Day)",
        "2025-08-11": "山の日 (Mountain Day)",
        "2025-09-15": "敬老の日 (Respect for the Aged Day)",
        "2025-09-23": "秋分の日 (Autumnal Equinox Day)",
        "2025-10-13": "スポーツの日 (Sports Day)",
        "2025-11-03": "文化の日 (Culture Day)",
        "2025-11-23": "勤労感謝の日 (Labor Thanksgiving Day)",
        "2025-11-24": "振替休日 (Substitute Holiday)",
      };

      /**
       * Initialize calendar
       */
      function initializeCalendar() {
        // Set view toggle listeners
        document.querySelectorAll(".view-toggle-btn").forEach((btn) => {
          btn.addEventListener("click", function () {
            document
              .querySelectorAll(".view-toggle-btn")
              .forEach((b) => b.classList.remove("active"));
            this.classList.add("active");
            currentView = this.dataset.view;
            renderCalendar();
          });
        });

        // Set today's date for quick add
        document.getElementById("planDate").value = new Date()
          .toISOString()
          .split("T")[0];

        // Initialize shift suggestions
        generateShiftSuggestions();

        // Render initial calendar
        renderCalendar();
      }

      /**
       * Generate shift suggestions based on previous shifts
       */
      function generateShiftSuggestions() {
        const suggestionsList = document.getElementById("shiftSuggestions");
        if (!suggestionsList) return;

        // Get unique shift patterns from history
        const shiftPatterns = new Map();

        weeklyData.forEach((entry) => {
          const key = `${entry.shiftType}-${entry.startTime}-${entry.endTime}`;
          if (!shiftPatterns.has(key)) {
            shiftPatterns.set(key, {
              shiftType: entry.shiftType,
              startTime: entry.startTime,
              endTime: entry.endTime,
              count: 1,
              lastUsed: entry.workDate,
            });
          } else {
            const pattern = shiftPatterns.get(key);
            pattern.count++;
            if (entry.workDate > pattern.lastUsed) {
              pattern.lastUsed = entry.workDate;
            }
          }
        });

        // Sort by usage frequency and recency
        const sortedPatterns = Array.from(shiftPatterns.values())
          .sort((a, b) => {
            if (b.count !== a.count) return b.count - a.count;
            return new Date(b.lastUsed) - new Date(a.lastUsed);
          })
          .slice(0, 5);

        // Add default shift patterns if no history
        if (sortedPatterns.length === 0) {
          sortedPatterns.push(
            {
              shiftType: "C341",
              startTime: "06:30",
              endTime: "17:30",
              count: 0,
            },
            {
              shiftType: "C342",
              startTime: "16:45",
              endTime: "01:25",
              count: 0,
            }
          );
        }

        // Generate suggestions HTML
        suggestionsList.innerHTML = sortedPatterns
          .map(
            (pattern) => `
                <div class="shift-suggestion" onclick="applySuggestion('${
                  pattern.shiftType
                }', '${pattern.startTime}', '${pattern.endTime}')">
                    <div class="suggestion-header">
                        <span class="suggestion-shift">${
                          pattern.shiftType
                        }</span>
                        <span class="suggestion-times">${pattern.startTime} - ${
              pattern.endTime
            }</span>
                    </div>
                    ${
                      pattern.count > 0
                        ? `<div class="suggestion-count">Used ${pattern.count} times</div>`
                        : ""
                    }
                </div>
            `
          )
          .join("");
      }

      /**
       * Apply suggestion to form
       */
      function applySuggestion(shiftType, startTime, endTime) {
        document.getElementById("planShiftType").value = shiftType;
        document.getElementById("planStartTime").value = startTime;
        document.getElementById("planEndTime").value = endTime;

        showMessage("Suggestion applied! Adjust times if needed.", "success");
      }

      /**
       * Update shift times when type changes
       */
      function updateShiftTimes() {
        const shiftType = document.getElementById("planShiftType").value;
        const startTimeInput = document.getElementById("planStartTime");
        const endTimeInput = document.getElementById("planEndTime");

        if (shiftType === "C341") {
          startTimeInput.value = "06:30";
          endTimeInput.value = "17:30";
        } else if (shiftType === "C342") {
          startTimeInput.value = "16:45";
          endTimeInput.value = "01:25";
        }
      }

      /**
       * Render calendar based on current view
       */
      function renderCalendar() {
        if (currentView === "month") {
          renderMonthView();
        } else {
          renderWeekView();
        }
        updateMonthlySummary();
      }

      /**
       * Render month view
       */
      function renderMonthView() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startingDayOfWeek = firstDay.getDay();

        document.getElementById("currentPeriod").textContent =
          firstDay.toLocaleDateString("en-US", {
            month: "long",
            year: "numeric",
          });

        let calendarHTML = '<div class="calendar-header">';
        const weekDays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
        weekDays.forEach((day) => {
          calendarHTML += `<div class="week-day">${day}</div>`;
        });
        calendarHTML += '</div><div class="calendar-body">';

        for (let i = 0; i < startingDayOfWeek; i++) {
          calendarHTML += '<div class="calendar-day empty"></div>';
        }

        for (let day = 1; day <= daysInMonth; day++) {
          const dateStr = `${year}-${String(month + 1).padStart(
            2,
            "0"
          )}-${String(day).padStart(2, "0")}`;
          const dayData = getDayData(dateStr);
          const isToday = isDateToday(dateStr);
          const isWeekend =
            new Date(year, month, day).getDay() === 0 ||
            new Date(year, month, day).getDay() === 6;
          const isHoliday = holidays[dateStr];

          let dayClasses = "calendar-day";
          if (isToday) dayClasses += " today";
          if (isWeekend) dayClasses += " weekend";
          if (isHoliday) dayClasses += " holiday";
          if (dayData.length > 0) dayClasses += " has-shift";

          calendarHTML += `
                    <div class="${dayClasses}" data-date="${dateStr}" onclick="showDayDetails('${dateStr}')">
                        <div class="day-number">${day}</div>
                        ${
                          isHoliday
                            ? `<div class="holiday-name">${holidays[dateStr]}</div>`
                            : ""
                        }
                        ${renderDayShifts(dayData)}
                        ${
                          dayData.length > 0
                            ? `<div class="day-earnings">¥${calculateDayEarnings(
                                dayData
                              ).toLocaleString()}</div>`
                            : ""
                        }
                    </div>
                `;
        }

        const remainingCells = 42 - (startingDayOfWeek + daysInMonth);
        for (let i = 0; i < remainingCells; i++) {
          calendarHTML += '<div class="calendar-day empty"></div>';
        }

        calendarHTML += "</div>";
        document.getElementById("calendarGrid").innerHTML = calendarHTML;
        document.getElementById("calendarGrid").className =
          "calendar-grid month-view";
      }

      /**
       * Render week view (simplified for space)
       */
      function renderWeekView() {
        // Implementation similar to month view but for week
        document.getElementById("currentPeriod").textContent = "Week View";
        document.getElementById("calendarGrid").innerHTML =
          '<div style="text-align: center; padding: 50px;">Week view implementation</div>';
      }

      /**
       * Get shift data for a specific date
       */
      function getDayData(dateStr) {
        const actualShifts = weeklyData.filter(
          (entry) => entry.workDate === dateStr
        );
        const planned = plannedShifts.filter(
          (shift) => shift.date === dateStr && !shift.completed
        );
        return [...actualShifts, ...planned];
      }

      /**
       * Render shifts for a day in month view
       */
      function renderDayShifts(dayData) {
        if (dayData.length === 0) return "";

        let shiftsHTML = '<div class="day-shifts">';
        dayData.forEach((shift) => {
          const shiftClass =
            shift.shiftType === "C341" ? "day-shift" : "night-shift";
          const isPlanned = shift.planned || false;
          shiftsHTML += `
                    <div class="shift-indicator ${shiftClass} ${
            isPlanned ? "planned" : ""
          }">
                        ${shift.shiftType}
                    </div>
                `;
        });
        shiftsHTML += "</div>";
        return shiftsHTML;
      }

      /**
       * Calculate total earnings for a day
       */
      function calculateDayEarnings(dayData) {
        return dayData.reduce((total, shift) => {
          if (shift.payInfo && shift.payInfo.totalPay) {
            return total + shift.payInfo.totalPay;
          }
          return total;
        }, 0);
      }

      /**
       * Check if date is today
       */
      function isDateToday(dateStr) {
        const today = new Date().toISOString().split("T")[0];
        return dateStr === today;
      }

      /**
       * Navigate calendar
       */
      function navigateCalendar(direction) {
        if (currentView === "month") {
          if (direction === "prev") {
            currentDate.setMonth(currentDate.getMonth() - 1);
          } else {
            currentDate.setMonth(currentDate.getMonth() + 1);
          }
        } else {
          if (direction === "prev") {
            currentDate.setDate(currentDate.getDate() - 7);
          } else {
            currentDate.setDate(currentDate.getDate() + 7);
          }
        }
        renderCalendar();
      }

      /**
       * Go to today
       */
      function goToToday() {
        currentDate = new Date();
        renderCalendar();
      }

      /**
       * Show day details in modal with edit functionality
       */
      function showDayDetails(dateStr) {
        const dayData = getDayData(dateStr);
        const modal = document.getElementById("shiftModal");
        const modalContent = document.getElementById("modalContent");

        const date = new Date(dateStr);
        const dayName = date.toLocaleDateString("en-US", {
          weekday: "long",
          month: "long",
          day: "numeric",
          year: "numeric",
        });

        let contentHTML = `<h4>${dayName}</h4>`;

        if (dayData.length === 0) {
          contentHTML += "<p>No shifts scheduled for this day.</p>";
        } else {
          contentHTML += '<div class="shift-details-list">';
          dayData.forEach((shift, index) => {
            const isPlanned = shift.planned || false;
            const canEdit = !isPlanned;

            contentHTML += `
                        <div class="shift-detail-item ${
                          isPlanned ? "planned" : ""
                        }" id="shift-${dateStr}-${index}">
                            <div class="shift-detail-header">
                                <h5>${shift.shiftType} - ${
              isPlanned ? "Planned" : "Worked"
            }</h5>
                                ${
                                  canEdit
                                    ? `
                                    <div class="shift-actions">
                                        <button class="edit-shift-btn" onclick="editShift('${dateStr}', ${index})">✏️ Edit</button>
                                        <button class="delete-shift-btn" onclick="deleteShiftFromCalendar('${dateStr}', ${index})">🗑️ Delete</button>
                                    </div>
                                `
                                    : ""
                                }
                            </div>
                            <div class="shift-detail-content">
                                <p><strong>Time:</strong> ${
                                  shift.startTime || "TBD"
                                } - ${shift.endTime || "TBD"}</p>
                                ${
                                  shift.workingTime
                                    ? `<p><strong>Hours:</strong> ${shift.workingTime.netHours.toFixed(
                                        2
                                      )}h</p>`
                                    : ""
                                }
                                ${
                                  shift.payInfo
                                    ? `<p><strong>Earnings:</strong> ¥${Math.round(
                                        shift.payInfo.totalPay
                                      ).toLocaleString()}</p>`
                                    : ""
                                }
                                ${
                                  shift.payInfo && shift.payInfo.hasNightHours
                                    ? '<p><span class="night-premium-badge">Night Premium Applied</span></p>'
                                    : ""
                                }
                                ${
                                  shift.payInfo &&
                                  shift.payInfo.overtimeHours > 0
                                    ? `<p><span class="overtime-badge">Overtime: ${shift.payInfo.overtimeHours.toFixed(
                                        1
                                      )}h</span></p>`
                                    : ""
                                }
                            </div>
                        </div>
                    `;
          });
          contentHTML += "</div>";
        }

        if (new Date(dateStr) >= new Date().setHours(0, 0, 0, 0)) {
          contentHTML += `
                    <button class="quick-add-modal-btn" onclick="quickAddShiftForDate('${dateStr}')">
                        + Add Shift for This Day
                    </button>
                `;
        }

        modalContent.innerHTML = contentHTML;
        modal.style.display = "block";
      }

      /**
       * Edit shift inline
       */
      function editShift(dateStr, shiftIndex) {
        const shiftEntry = weeklyData.find(
          (entry) => entry.workDate === dateStr
        );
        if (!shiftEntry) return;

        editingEntry = {
          dateStr,
          shiftIndex,
          originalEntry: { ...shiftEntry },
        };

        const shiftDetailItem = document.getElementById(
          `shift-${dateStr}-${shiftIndex}`
        );
        const contentDiv = shiftDetailItem.querySelector(
          ".shift-detail-content"
        );

        contentDiv.innerHTML = `
                <div class="edit-shift-form">
                    <div class="form-row">
                        <label>Shift Type:</label>
                        <select id="editShiftType" onchange="updateEditShiftTimes()">
                            <option value="C341" ${
                              shiftEntry.shiftType === "C341" ? "selected" : ""
                            }>C341 - Day Shift</option>
                            <option value="C342" ${
                              shiftEntry.shiftType === "C342" ? "selected" : ""
                            }>C342 - Night Shift</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label>Start Time:</label>
                        <input type="time" id="editStartTime" value="${
                          shiftEntry.startTime
                        }">
                    </div>
                    <div class="form-row">
                        <label>End Time:</label>
                        <input type="time" id="editEndTime" value="${
                          shiftEntry.endTime
                        }">
                    </div>
                    <div class="form-actions">
                        <button class="save-btn" onclick="saveShiftEdit()">💾 Save</button>
                        <button class="cancel-btn" onclick="cancelShiftEdit()">❌ Cancel</button>
                    </div>
                </div>
            `;
      }

      /**
       * Update default times when editing shift type
       */
      function updateEditShiftTimes() {
        const shiftType = document.getElementById("editShiftType").value;
        const startTimeInput = document.getElementById("editStartTime");
        const endTimeInput = document.getElementById("editEndTime");

        if (shiftType === "C341") {
          startTimeInput.value = "06:30";
          endTimeInput.value = "17:30";
        } else if (shiftType === "C342") {
          startTimeInput.value = "16:45";
          endTimeInput.value = "01:25";
        }
      }

      /**
       * Save shift edit
       */
      function saveShiftEdit() {
        if (!editingEntry) return;

        const newShiftType = document.getElementById("editShiftType").value;
        const newStartTime = document.getElementById("editStartTime").value;
        const newEndTime = document.getElementById("editEndTime").value;

        if (!newShiftType || !newStartTime || !newEndTime) {
          showMessage("Please fill in all fields!", "error");
          return;
        }

        const entryIndex = weeklyData.findIndex(
          (entry) =>
            entry.workDate === editingEntry.dateStr &&
            entry.shiftType === editingEntry.originalEntry.shiftType &&
            entry.startTime === editingEntry.originalEntry.startTime
        );

        if (entryIndex !== -1) {
          weeklyData[entryIndex] = {
            ...weeklyData[entryIndex],
            shiftType: newShiftType,
            startTime: newStartTime,
            endTime: newEndTime,
            timestamp: new Date().toISOString(),
          };

          localStorage.setItem("weeklyData", JSON.stringify(weeklyData));

          renderCalendar();
          showDayDetails(editingEntry.dateStr);

          showMessage("Shift updated successfully!", "success");
        }

        editingEntry = null;
      }

      /**
       * Cancel shift edit
       */
      function cancelShiftEdit() {
        if (!editingEntry) return;

        showDayDetails(editingEntry.dateStr);
        editingEntry = null;
      }

      /**
       * Delete shift from calendar
       */
      function deleteShiftFromCalendar(dateStr, shiftIndex) {
        if (confirm("Are you sure you want to delete this shift?")) {
          const entryIndex = weeklyData.findIndex(
            (entry) => entry.workDate === dateStr
          );

          if (entryIndex !== -1) {
            weeklyData.splice(entryIndex, 1);
            localStorage.setItem("weeklyData", JSON.stringify(weeklyData));

            renderCalendar();
            showDayDetails(dateStr);

            showMessage("Shift deleted successfully!", "success");
          }
        }
      }

      /**
       * Close modal
       */
      function closeModal() {
        document.getElementById("shiftModal").style.display = "none";
        editingEntry = null;
      }

      /**
       * Enhanced quick add shift with time inputs
       */
      function quickAddShift() {
        const date = document.getElementById("planDate").value;
        const shiftType = document.getElementById("planShiftType").value;
        const startTime = document.getElementById("planStartTime").value;
        const endTime = document.getElementById("planEndTime").value;

        if (!date || !shiftType || !startTime || !endTime) {
          showMessage("Please fill in all fields!", "error");
          return;
        }

        const existingShift = weeklyData.find(
          (entry) => entry.workDate === date
        );
        if (existingShift) {
          showMessage(
            "A shift already exists for this date. Please edit it instead.",
            "error"
          );
          return;
        }

        const plannedShift = {
          date: date,
          shiftType: shiftType,
          startTime: startTime,
          endTime: endTime,
          planned: true,
          id: Date.now(),
          createdAt: new Date().toISOString(),
        };

        plannedShifts.push(plannedShift);
        localStorage.setItem("plannedShifts", JSON.stringify(plannedShifts));

        document.getElementById("planShiftType").value = "";
        document.getElementById("planStartTime").value = "";
        document.getElementById("planEndTime").value = "";

        renderCalendar();
        generateShiftSuggestions();

        showMessage("Shift added to calendar!", "success");
      }

      /**
       * Quick add shift for specific date from modal
       */
      function quickAddShiftForDate(dateStr) {
        document.getElementById("planDate").value = dateStr;
        closeModal();
        document.getElementById("planShiftType").focus();
      }

      /**
       * Update monthly summary
       */
      function updateMonthlySummary() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const monthStart = `${year}-${String(month + 1).padStart(2, "0")}-01`;
        const monthEnd = `${year}-${String(month + 1).padStart(
          2,
          "0"
        )}-${new Date(year, month + 1, 0).getDate()}`;

        const monthlyData = weeklyData.filter(
          (entry) => entry.workDate >= monthStart && entry.workDate <= monthEnd
        );

        const totalDays = monthlyData.length;
        const totalHours = monthlyData.reduce(
          (sum, entry) => sum + (entry.workingTime?.netHours || 0),
          0
        );
        const totalEarnings = monthlyData.reduce(
          (sum, entry) => sum + (entry.payInfo?.totalPay || 0),
          0
        );
        const avgDaily = totalDays > 0 ? totalEarnings / totalDays : 0;

        document.getElementById("totalDays").textContent = totalDays;
        document.getElementById("totalHours").textContent =
          totalHours.toFixed(1) + "h";
        document.getElementById("totalEarnings").textContent =
          "¥" + Math.round(totalEarnings).toLocaleString();
        document.getElementById("avgDaily").textContent =
          "¥" + Math.round(avgDaily).toLocaleString();
      }

      /**
       * Export calendar
       */
      function exportCalendar() {
        showMessage(
          "Export functionality would be implemented here",
          "success"
        );
      }

      /**
       * Show message
       */
      function showMessage(message, type = "success") {
        const messageDiv = document.createElement("div");
        messageDiv.textContent = message;
        messageDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 9999;
                padding: 15px 20px;
                border-radius: 10px;
                color: white;
                font-weight: 600;
                background: ${type === "success" ? "#28a745" : "#dc3545"};
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            `;

        document.body.appendChild(messageDiv);

        setTimeout(() => {
          messageDiv.remove();
        }, 3000);
      }

      // Mobile menu functions
      function toggleMobileMenu() {
        const sidebar = document.querySelector(".sidebar");
        const overlay = document.querySelector(".mobile-overlay");
        const toggle = document.querySelector(".mobile-menu-toggle");

        sidebar.classList.toggle("mobile-open");
        overlay.classList.toggle("active");
        toggle.innerHTML = sidebar.classList.contains("mobile-open")
          ? "✕"
          : "☰";
      }

      function closeMobileMenu() {
        const sidebar = document.querySelector(".sidebar");
        const overlay = document.querySelector(".mobile-overlay");
        const toggle = document.querySelector(".mobile-menu-toggle");

        sidebar.classList.remove("mobile-open");
        overlay.classList.remove("active");
        toggle.innerHTML = "☰";
      }

      // Close modal when clicking outside
      window.onclick = function (event) {
        const modal = document.getElementById("shiftModal");
        if (event.target === modal) {
          closeModal();
        }
      };

      // Initialize calendar on page load
      document.addEventListener("DOMContentLoaded", function () {
        initializeCalendar();
      });
    </script>
  </body>
  <script src="break_schedule.js"></script>
  <script src="script.js"></script>
  <script src="calendar.js"></script>
</html>
